import os
import pandas as pd
import json

# Carrega configuração de diretórios e GitHub
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
CONFIG_PATH = os.path.join(BASE_DIR, "configuracoes", "configuração diretórios.json")
with open(CONFIG_PATH, encoding="utf-8") as f:
    cfg = json.load(f)

CSV_DIR = os.path.join(BASE_DIR, cfg["CSV_DIR"])
CSV_PATTERN = cfg.get("CSV_PATTERN", "tenis_dados_atual.csv")
CSV_PATH = os.path.join(CSV_DIR, CSV_PATTERN)

USUARIO_GITHUB = cfg["USUARIO_GITHUB"]
REPOSITORIO_GITHUB = cfg["REPOSITORIO_GITHUB"]
IMAGENS_LIMPAS_GITHUB_DIR = cfg["IMAGENS_LIMPAS_GITHUB_DIR"]

# Mostra o molde padrão de URL
print("Molde padrão de URL GitHub gerado:")
print(f"https://raw.githubusercontent.com/{USUARIO_GITHUB}/{REPOSITORIO_GITHUB}/main/{IMAGENS_LIMPAS_GITHUB_DIR}/<nome_da_imagem>")

# Carrega o CSV
df = pd.read_csv(CSV_PATH)
df["image_link_github"] = ""
df["image2_link_github"] = ""

# Para cada linha do CSV, gera o link bruto do GitHub para as imagens limpas
for idx, row in df.iterrows():
    img1 = row.get("imagem_local1", "")
    img2 = row.get("imagem_local2", "")
    if img1:
        link1 = f"https://raw.githubusercontent.com/{USUARIO_GITHUB}/{REPOSITORIO_GITHUB}/main/{IMAGENS_LIMPAS_GITHUB_DIR}/{img1}"
        df.at[idx, "image_link_github"] = link1
    if img2:
        link2 = f"https://raw.githubusercontent.com/{USUARIO_GITHUB}/{REPOSITORIO_GITHUB}/main/{IMAGENS_LIMPAS_GITHUB_DIR}/{img2}"
        df.at[idx, "image2_link_github"] = link2

# Salva o CSV atualizado (mantendo o mesmo nome)
df.to_csv(CSV_PATH, index=False, encoding="utf-8-sig")
print(f"CSV atualizado em: {CSV_PATH}")